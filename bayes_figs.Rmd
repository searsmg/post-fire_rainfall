---
title: "Bayes figures"
author: "Megan Sears"
date: "`r Sys.Date()`"
output: html_document
---

```{r, include = F}

library(pacman)

p_load(tidyverse, 
       bayesplot,
       here,
       posterior,
       viridis,
       cowplot,
       reshape,
       ggdist)

# Set a basic ggplot theme
theme_set(theme_bw(base_size = 20))

```

# Stage rise

## Global

```{r}

stageRise <- readRDS(here("./data/bayes_interaction_outputs/global_stageRise_final.rds"))

sr_summary <- stageRise_df %>%
  group_by(variable) %>%
  summarize(mean = mean(value),
            median = median(value),
            min = min(value),
            max = max(value),
            lower_66 = quantile(value, 0.17),
            upper_66 = quantile(value, 0.83),
            lower_95 = quantile(value, 0.025),
            upper_95 = quantile(value, 0.975),
            percent_positive = round(mean(value > 0) * 100, 1)) %>%
  mutate(percent_positive_label = paste0("P>0 = ", 
                                         sprintf("%.1f", 
                                                 percent_positive), "%")) %>%
  mutate(response = 'Stage rise')

var_levels <- c(
  "MI60", 
  "Fire", 
  "Snow zone", 
  "Year"
)

stageRise_df <- as_draws(stageRise) %>% 
  data.frame() %>%
  select(MI60_mmhr, fireetf, sp_catlow, yearCont) %>%
  melt() %>%
  mutate(variable = case_match(variable,
    "MI60_mmhr"   ~ "MI60",
    "fireetf"     ~ "Fire",
    "sp_catlow"   ~ "Snow zone",
    "yearCont"    ~ "Year")) %>%
   mutate(variable = fct_relevel(variable, var_levels))

  
globalStage <- ggplot(stageRise_df, 
                      aes(x = value,
                          y=variable)) +
  geom_vline(xintercept = 0) +
  stat_slab(aes(fill = after_stat(level)), 
            .width = c(.66, .95, 1),
            color='grey',
            linewidth = 0.3) +
  stat_pointinterval(.width = c(.66, .95, 1), 
                     fatten_point = 2.5,
                     interval_size_domain = c(2,5,10),
                     color = '#D50032FF') +
  paletteer::scale_fill_paletteer_d("nbapalettes::kings_city") +
  scale_y_discrete(limits = rev(var_levels)) +
    theme(legend.position = 'none',
        strip.background = element_rect(fill = "white", color = NA),
        strip.text = element_text(hjust = 0),
        text = element_text(color = "black")) +
  labs(x = 'Scaled coefficient',
       y = NULL)

globalStage

```

## NDVI over time

```{r}

ndvi <- read_csv('./data/final_model_inputs/inputs_combine.csv') %>%
  select(site,
         burn_cat,
         fire,
         NDVI_2021.x,
         NDVI_2022.x,
         NDVI_2023.x)





```


## NDVI

```{r}

srNDVI <- readRDS('./data/bayes_interaction_outputs/ndvi_stageRise_final.rds')

SRndviPlot <- as_draws(srNDVI) %>% 
  data.frame() %>%
  select(NDVI, 
         MI60_mmhr.NDVI, 
         yearCont.NDVI, 
         MI60_mmhr.yearCont.NDVI) %>%
  melt() %>%
  ggplot(., aes(x = value, 
                fill = variable)) + 
  theme_bw(base_size = 20) +
  geom_vline(xintercept = 0) + 
  stat_slab(aes(fill = after_stat(level)), 
            .width = c(.66, .95, 1), 
            color = 'gray50') +
  stat_pointinterval(.width = c(.66, .95, 1), 
                     fatten_point = 2.5, 
                     color = 'darkred', 
                     interval_size_domain = c(2,5,10)) +
  paletteer::scale_fill_paletteer_d("soilpalettes::gley") +
  facet_wrap(~variable, 
             ncol = 1) +
  theme(legend.position = 'none') +
  theme(legend.position = 'none',
        strip.background = element_rect(fill = "white", color = NA),
        strip.text = element_text(hjust = 0),
        text = element_text(family = "Helvetica")) +
  labs(x = 'Scaled coefficient',
       y = NULL) +
  ggtitle('Stage rise')

SRndviPlot

```

## Interactions

```{r}

sr_inter <- read_csv('./data/bayes_interaction_outputs/stageRiseInterac_summary_final.csv') %>%
  mutate(variable = dplyr::recode(variable,
    "MI60_mmhr.terrain_connec"    = "Connectivity",
    "MI60_mmhr.soil_clay"         = "Clay",
    "MI60_mmhr.terrain_slope30"   = "Slope > 30",
    "MI60_mmhr.terrain_vall_holl" = "Valleys & hollows",
    "MI60_mmhr.lag_pwd"           = "PWD",
    "MI60_mmhr.mean_dnbr"         = "dNBR",
    "MI60_mmhr.terrain_elongation" = "Elongation",
    "MI60_mmhr.terrain_recharge" = 'Recharge areas',
    "MI60_mmhr.terrain_glacial" = "Glacial deposits",
    "MI60_mmhr.mulch_frac" = "Mulched areas",
    "MI60_mmhr.SP_mean" = 'Snow persistence',
    "MI60_mmhr.terrain_hypso75" = ">75% elevation",
    "MI60_mmhr.terrain_flowlength" = 'Flow length',
    "MI60_mmhr.soil_ksat" = 'Ksat')) %>%
    arrange(abs(mean)) %>%
    mutate(variable = factor(variable, levels = variable))

srInt_plot <- ggplot(sr_inter, aes(y = variable)) +
  geom_vline(xintercept = 0) +
  # min to max (lightest)
  geom_linerange(aes(xmin = min, xmax = max), linewidth = 0.6, color = "steelblue1") +
  # 95% interval (medium)
  geom_linerange(aes(xmin = lower_95, xmax = upper_95), linewidth = 1, color = "steelblue3") +
  # 66% interval (darkest)
  geom_linerange(aes(xmin = lower_66, xmax = upper_66), linewidth = 2, color = "steelblue4") +
  # mean point
  geom_point(aes(x = mean), size = 4, shape = 21, fill = "white", color = "black") +
  labs(x = "Scaled coefficient", y = NULL) +
  theme(
    panel.grid = element_blank(),
    axis.text = element_text(color = "black"),
    axis.title = element_text(color = "black")) +
  ggtitle('Stage rise')

```

## Interactions by fire

```{r}

etf_sr_inter <- read_csv('./data/bayes_interaction_outputs/etf_stageRiseInterac_summary_prelim.csv') %>%
  mutate(variable = dplyr::recode(variable,
    "MI60_mmhr.terrain_connec"    = "Connectivity",
    "MI60_mmhr.soil_clay"         = "Clay",
    "MI60_mmhr.terrain_slope30"   = "Slope > 30",
    "MI60_mmhr.terrain_vall_holl" = "Valleys & hollows",
    "MI60_mmhr.lag_pwd"           = "PWD",
    "MI60_mmhr.mean_dnbr"         = "dNBR",
    "MI60_mmhr.terrain_elongation" = "Elongation",
    "MI60_mmhr.terrain_recharge" = 'Recharge areas',
    "MI60_mmhr.terrain_glacial" = "Glacial deposits",
    "MI60_mmhr.mulch_frac" = "Mulched areas",
    "MI60_mmhr.SP_mean" = 'Snow persistence',
    "MI60_mmhr.terrain_hypso75" = ">75% elevation",
    "MI60_mmhr.terrain_flowlength" = 'Flow length',
    "MI60_mmhr.soil_ksat" = 'Ksat')) %>%
    arrange(abs(mean)) %>%
    mutate(variable = factor(variable, levels = variable))

etf_srInt_plot <- ggplot(etf_sr_inter, aes(y = variable)) +
  geom_vline(xintercept = 0) +
  # min to max (lightest)
  geom_linerange(aes(xmin = min, xmax = max), linewidth = 0.6, color = "steelblue1") +
  # 95% interval (medium)
  geom_linerange(aes(xmin = lower_95, xmax = upper_95), linewidth = 1, color = "steelblue3") +
  # 66% interval (darkest)
  geom_linerange(aes(xmin = lower_66, xmax = upper_66), linewidth = 2, color = "steelblue4") +
  # mean point
  geom_point(aes(x = mean), size = 4, shape = 21, fill = "white", color = "black") +
  labs(x = "Scaled coefficient", y = NULL) +
  theme(
    panel.grid = element_blank(),
    axis.text = element_text(color = "black"),
    axis.title = element_text(color = "black")) +
  ggtitle('ETF - Stage rise')

etf_srInt_plot

cpf_sr_inter <- read_csv('./data/bayes_interaction_outputs/cpf_stageRiseInterac_summary_prelim.csv') %>%
  mutate(variable = dplyr::recode(variable,
    "MI60_mmhr.terrain_connec"    = "Connectivity",
    "MI60_mmhr.soil_clay"         = "Clay",
    "MI60_mmhr.terrain_slope30"   = "Slope > 30",
    "MI60_mmhr.terrain_vall_holl" = "Valleys & hollows",
    "MI60_mmhr.lag_pwd"           = "PWD",
    "MI60_mmhr.mean_dnbr"         = "dNBR",
    "MI60_mmhr.terrain_elongation" = "Elongation",
    "MI60_mmhr.terrain_recharge" = 'Recharge areas',
    "MI60_mmhr.terrain_glacial" = "Glacial deposits",
    "MI60_mmhr.mulch_frac" = "Mulched areas",
    "MI60_mmhr.SP_mean" = 'Snow persistence',
    "MI60_mmhr.terrain_hypso75" = ">75% elevation",
    "MI60_mmhr.terrain_flowlength" = 'Flow length',
    "MI60_mmhr.soil_ksat" = 'Ksat')) %>%
    arrange(abs(mean)) %>%
    mutate(variable = factor(variable, levels = variable))

cpf_srInt_plot <- ggplot(cpf_sr_inter, aes(y = variable)) +
  geom_vline(xintercept = 0) +
  # min to max (lightest)
  geom_linerange(aes(xmin = min, xmax = max), linewidth = 0.6, color = "steelblue1") +
  # 95% interval (medium)
  geom_linerange(aes(xmin = lower_95, xmax = upper_95), linewidth = 1, color = "steelblue3") +
  # 66% interval (darkest)
  geom_linerange(aes(xmin = lower_66, xmax = upper_66), linewidth = 2, color = "steelblue4") +
  # mean point
  geom_point(aes(x = mean), size = 4, shape = 21, fill = "white", color = "black") +
  labs(x = "Scaled coefficient", y = NULL) +
  theme(
    panel.grid = element_blank(),
    axis.text = element_text(color = "black"),
    axis.title = element_text(color = "black")) +
  ggtitle('CPF - Stage rise')

cpf_srInt_plot

plot_grid(cpf_srInt_plot,
          etf_srInt_plot)

```

## Interactions by SZ

```{r}

high_sr_inter <- read_csv('./data/bayes_interaction_outputs/high_stageRiseInterac_summary_prelim.csv') %>%
  mutate(variable = dplyr::recode(variable,
    "MI60_mmhr.terrain_connec"    = "Connectivity",
    "MI60_mmhr.soil_clay"         = "Clay",
    "MI60_mmhr.terrain_slope30"   = "Slope > 30",
    "MI60_mmhr.terrain_vall_holl" = "Valleys & hollows",
    "MI60_mmhr.lag_pwd"           = "PWD",
    "MI60_mmhr.mean_dnbr"         = "dNBR",
    "MI60_mmhr.terrain_elongation" = "Elongation",
    "MI60_mmhr.terrain_recharge" = 'Recharge areas',
    "MI60_mmhr.terrain_glacial" = "Glacial deposits",
    "MI60_mmhr.mulch_frac" = "Mulched areas",
    "MI60_mmhr.SP_mean" = 'Snow persistence',
    "MI60_mmhr.terrain_hypso75" = ">75% elevation",
    "MI60_mmhr.terrain_flowlength" = 'Flow length',
    "MI60_mmhr.soil_ksat" = 'Ksat')) %>%
    arrange(abs(mean)) %>%
    mutate(variable = factor(variable, levels = variable))

high_srInt_plot <- ggplot(high_sr_inter, aes(y = variable)) +
  geom_vline(xintercept = 0) +
  # min to max (lightest)
  geom_linerange(aes(xmin = min, xmax = max), linewidth = 0.6, color = "steelblue1") +
  # 95% interval (medium)
  geom_linerange(aes(xmin = lower_95, xmax = upper_95), linewidth = 1, color = "steelblue3") +
  # 66% interval (darkest)
  geom_linerange(aes(xmin = lower_66, xmax = upper_66), linewidth = 2, color = "steelblue4") +
  # mean point
  geom_point(aes(x = mean), size = 4, shape = 21, fill = "white", color = "black") +
  labs(x = "Scaled coefficient", y = NULL) +
  theme(
    panel.grid = element_blank(),
    axis.text = element_text(color = "black"),
    axis.title = element_text(color = "black")) +
  ggtitle('High - Stage rise')

high_srInt_plot

low_sr_inter <- read_csv('./data/bayes_interaction_outputs/low_stageRiseInterac_summary_prelim.csv') %>%
  mutate(variable = dplyr::recode(variable,
    "MI60_mmhr.terrain_connec"    = "Connectivity",
    "MI60_mmhr.soil_clay"         = "Clay",
    "MI60_mmhr.terrain_slope30"   = "Slope > 30",
    "MI60_mmhr.terrain_vall_holl" = "Valleys & hollows",
    "MI60_mmhr.lag_pwd"           = "PWD",
    "MI60_mmhr.mean_dnbr"         = "dNBR",
    "MI60_mmhr.terrain_elongation" = "Elongation",
    "MI60_mmhr.terrain_recharge" = 'Recharge areas',
    "MI60_mmhr.terrain_glacial" = "Glacial deposits",
    "MI60_mmhr.mulch_frac" = "Mulched areas",
    "MI60_mmhr.SP_mean" = 'Snow persistence',
    "MI60_mmhr.terrain_hypso75" = ">75% elevation",
    "MI60_mmhr.terrain_flowlength" = 'Flow length',
    "MI60_mmhr.soil_ksat" = 'Ksat')) %>%
    arrange(abs(mean)) %>%
    mutate(variable = factor(variable, levels = variable))

low_srInt_plot <- ggplot(low_sr_inter, aes(y = variable)) +
  geom_vline(xintercept = 0) +
  # min to max (lightest)
  geom_linerange(aes(xmin = min, xmax = max), linewidth = 0.6, color = "steelblue1") +
  # 95% interval (medium)
  geom_linerange(aes(xmin = lower_95, xmax = upper_95), linewidth = 1, color = "steelblue3") +
  # 66% interval (darkest)
  geom_linerange(aes(xmin = lower_66, xmax = upper_66), linewidth = 2, color = "steelblue4") +
  # mean point
  geom_point(aes(x = mean), size = 4, shape = 21, fill = "white", color = "black") +
  labs(x = "Scaled coefficient", y = NULL) +
  theme(
    panel.grid = element_blank(),
    axis.text = element_text(color = "black"),
    axis.title = element_text(color = "black")) +
  ggtitle('Low - Stage rise')

low_srInt_plot

plot_grid(low_srInt_plot,
          high_srInt_plot)

```

# Lag to peak

## Global

```{r}
lag <- readRDS(here("./data/bayes_interaction_outputs/global_l2p_final.rds"))

var_levels <- c(
  "MI60", 
  "Fire", 
  "Snow zone", 
  "Year"
)

lag_df <- as_draws(lag) %>% 
  data.frame() %>%
  select(MI60_mmhr, fireetf, sp_catlow, yearCont) %>%
  melt() %>%
  mutate(variable = case_match(variable,
    "MI60_mmhr"   ~ "MI60",
    "fireetf"     ~ "Fire",
    "sp_catlow"   ~ "Snow zone",
    "yearCont"    ~ "Year")) %>%
   mutate(variable = factor(variable, levels = var_levels))

lag_summary <- lag_df %>%
  group_by(variable) %>%
  summarize(mean = mean(value),
            median = median(value),
            min = min(value),
            max = max(value),
            lower_66 = quantile(value, 0.17),
            upper_66 = quantile(value, 0.83),
            lower_95 = quantile(value, 0.025),
            upper_95 = quantile(value, 0.975),
            percent_positive = round(mean(value > 0) * 100, 1)) %>%
  mutate(percent_positive_label = paste0("P>0 = ", 
                                         sprintf("%.1f", 
                                                 percent_positive), "%")) %>%
  mutate(response = 'Lag to peak')

globalLag <- ggplot(lag_df, 
                    aes(x = value,
                        y = as.factor(variable))) +
  geom_vline(xintercept = 0) +
  stat_slab(aes(fill = after_stat(level)), 
            .width = c(.66, .95, 1),
            color = 'grey',
            linewidth = 0.3) +
  stat_pointinterval(.width = c(.66, .95, 1), 
                     fatten_point = 2.5,
                     interval_size_domain = c(2,5,10),
                     color = '#D50032FF') +
  paletteer::scale_fill_paletteer_d("nbapalettes::kings_city") +
  theme(
    legend.position = 'none',
    strip.background = element_rect(fill = "white", color = NA),
    strip.text = element_text(hjust = 0,
                              color='black',
                              face='bold'),
    text = element_text(color = "black",
                        family = 'sans',
                        #size=100
                        ),
    axis.text = element_text(color = "black"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank()
  ) +
  labs(x = 'Scaled coefficient',
       y = NULL) +
   geom_text(
    data = lag_summary, 
    aes(
      x = 2,
      y = as.factor(variable),
      label = percent_positive_label
    ),
    inherit.aes = FALSE,
    hjust = 1,
    size = 3,
    nudge_y = 0.12)


globalLag

```

## Combine - global fig

```{r}

# combine the two globals
stageRise_df <- stageRise_df %>%
  mutate(response = 'Stage rise')

lag_df <- lag_df %>%
  mutate(response = 'Lag to peak')

summary <- bind_rows(sr_summary,
                     lag_summary) %>%
    mutate(response = factor(response, 
                           levels = c("Stage rise", "Lag to peak")))

global <- bind_rows(stageRise_df,
                    lag_df) %>%
  mutate(variable = factor(variable, levels = var_levels)) %>%
  mutate(response = factor(response, 
                           levels = c("Stage rise", "Lag to peak")))
  


globalPlot <- ggplot(global, 
                    aes(x = value,
                        y=variable)) +
  geom_vline(xintercept = 0) +
  stat_slab(aes(fill = after_stat(level)), 
            .width = c(.66, .95, 1),
            color = 'grey',
            linewidth = 0.3) +
  stat_pointinterval(.width = c(.66, .95, 1),
                     fatten_point = 2,
                     interval_size_domain = c(2,5,10),
                     color = '#D50032FF') +
  paletteer::scale_fill_paletteer_d("nbapalettes::kings_city") +
  scale_y_discrete(limits = rev(var_levels)) + # expand = expansion(mult = c(0, 0.05))) +
  #facet_wrap(~response) +
  facet_grid(cols = vars(response)) +
  theme(
    legend.position = 'none',
    strip.background = element_rect(fill = "white", color = NA),
    strip.text = element_text(hjust = 0,
                              color='black',
                              face='bold'),
    text = element_text(color = "black",
                        family = 'sans',
                        #size=140
                        ),
    axis.text = element_text(color = "black"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor.x = element_blank()) +
  labs(x = 'Scaled coefficient',
       y = NULL) +
  geom_text(
    data = summary,
    aes(
      x = 2,
      y = as.factor(variable),
      label = percent_positive_label
    ),
    inherit.aes = FALSE,
    #size = 30,
    nudge_y = -0.12 # adjust text size
  )

globalPlot

ggsave(
  '/Users/megansears/Documents/Repos/post-fire_rainfall/figures/SR_response/global.png',
       dpi=800,
       width=12,
       height=8)



```


## NDVI

```{r}

lpNDVI <- readRDS('./data/bayes_interaction_outputs/ndvi_l2p_final.rds')

LPndviPlot <- as_draws(lpNDVI) %>% 
  data.frame() %>%
  select(NDVI, 
         MI60_mmhr.NDVI, 
         yearCont.NDVI, 
         MI60_mmhr.yearCont.NDVI) %>%
  melt() %>%
  ggplot(., aes(x = value, 
                fill = variable)) + 
  theme_bw(base_size = 20) +
  geom_vline(xintercept = 0) + 
  stat_slab(aes(fill = after_stat(level)), 
            .width = c(.66, .95, 1), 
            color = 'gray50') +
  stat_pointinterval(.width = c(.66, .95, 1), 
                     fatten_point = 2.5, 
                     color = 'darkred', 
                     interval_size_domain = c(2,5,10)) +
  paletteer::scale_fill_paletteer_d("soilpalettes::gley") +
  facet_wrap(~variable, 
             ncol = 1) +
  theme(legend.position = 'none') +
  theme(legend.position = 'none',
        strip.background = element_rect(fill = "white", color = NA),
        strip.text = element_text(hjust = 0),
        text = element_text(family = "Helvetica")) +
  labs(x = 'Scaled coefficient',
       y = NULL) +
  ggtitle('Lag to peak')

plot_grid(SRndviPlot, LPndviPlot)



```

## Interactions

```{r}

l2p_inter <- read_csv('./data/bayes_interaction_outputs/lag2peakInterac_summary_final.csv') %>%
  arrange(-abs(mean)) %>% 
    mutate(variable = dplyr::recode(variable,
    "MI60_mmhr.terrain_connec"    = "Connectivity",
    "MI60_mmhr.soil_clay"         = "Clay",
    "MI60_mmhr.terrain_slope30"   = "Slope > 30",
    "MI60_mmhr.terrain_vall_holl" = "Valleys & hollows",
    "MI60_mmhr.lag_pwd"           = "PWD",
    "MI60_mmhr.mean_dnbr"         = "dNBR",
    "MI60_mmhr.terrain_elongation" = "Elongation",
    "MI60_mmhr.terrain_recharge" = 'Recharge areas',
    "MI60_mmhr.terrain_glacial" = "Glacial deposits",
    "MI60_mmhr.mulch_frac" = "Mulched areas",
    "MI60_mmhr.SP_mean" = 'Snow persistence',
    "MI60_mmhr.terrain_hypso75" = ">75% elevation",
    "MI60_mmhr.terrain_flowlength" = 'Flow length',
    "MI60_mmhr.soil_ksat" = 'Ksat')) %>%
    arrange(abs(mean)) %>%
    mutate(variable = factor(variable, levels = variable))

l2pInt_plot <- ggplot(l2p_inter, aes(y = variable)) +
  geom_vline(xintercept = 0) +
  # min to max (lightest)
  geom_linerange(aes(xmin = min, xmax = max), linewidth = 0.6, color = "steelblue1") +
  # 95% interval (medium)
  geom_linerange(aes(xmin = lower_95, xmax = upper_95), linewidth = 1, color = "steelblue3") +
  # 66% interval (darkest)
  geom_linerange(aes(xmin = lower_66, xmax = upper_66), linewidth = 2, color = "steelblue4") +
  # mean point
  geom_point(aes(x = mean), size = 4, shape = 21, fill = "white", color = "black") +
  labs(x = "Scaled coefficient", y = NULL) +
  theme(
    panel.grid = element_blank(),
    axis.text = element_text(color = "black"),
    axis.title = element_text(color = "black")) +
  ggtitle('Lag to peak')

plot_grid(srInt_plot,l2pInt_plot)

```

## Interactions by fire

```{r}

etf_l2p_inter <- read_csv('./data/bayes_interaction_outputs/etf_lag2peakInterac_summary_prelim.csv') %>%
  arrange(-abs(mean)) %>% 
    mutate(variable = dplyr::recode(variable,
    "MI60_mmhr.terrain_connec"    = "Connectivity",
    "MI60_mmhr.soil_clay"         = "Clay",
    "MI60_mmhr.terrain_slope30"   = "Slope > 30",
    "MI60_mmhr.terrain_vall_holl" = "Valleys & hollows",
    "MI60_mmhr.lag_pwd"           = "PWD",
    "MI60_mmhr.mean_dnbr"         = "dNBR",
    "MI60_mmhr.terrain_elongation" = "Elongation",
    "MI60_mmhr.terrain_recharge" = 'Recharge areas',
    "MI60_mmhr.terrain_glacial" = "Glacial deposits",
    "MI60_mmhr.mulch_frac" = "Mulched areas",
    "MI60_mmhr.SP_mean" = 'Snow persistence',
    "MI60_mmhr.terrain_hypso75" = ">75% elevation",
    "MI60_mmhr.terrain_flowlength" = 'Flow length',
    "MI60_mmhr.soil_ksat" = 'Ksat')) %>%
    arrange(abs(mean)) %>%
    mutate(variable = factor(variable, levels = variable))

etf_l2pInt_plot <- ggplot(etf_l2p_inter, aes(y = variable)) +
  geom_vline(xintercept = 0) +
  # min to max (lightest)
  geom_linerange(aes(xmin = min, xmax = max), linewidth = 0.6, color = "steelblue1") +
  # 95% interval (medium)
  geom_linerange(aes(xmin = lower_95, xmax = upper_95), linewidth = 1, color = "steelblue3") +
  # 66% interval (darkest)
  geom_linerange(aes(xmin = lower_66, xmax = upper_66), linewidth = 2, color = "steelblue4") +
  # mean point
  geom_point(aes(x = mean), size = 4, shape = 21, fill = "white", color = "black") +
  labs(x = "Scaled coefficient", y = NULL) +
  theme(
    panel.grid = element_blank(),
    axis.text = element_text(color = "black"),
    axis.title = element_text(color = "black")) +
  ggtitle('ETF - Lag to peak')

cpf_l2p_inter <- read_csv('./data/bayes_interaction_outputs/cpf_lag2peakInterac_summary_prelim.csv') %>%
  arrange(-abs(mean)) %>% 
    mutate(variable = dplyr::recode(variable,
    "MI60_mmhr.terrain_connec"    = "Connectivity",
    "MI60_mmhr.soil_clay"         = "Clay",
    "MI60_mmhr.terrain_slope30"   = "Slope > 30",
    "MI60_mmhr.terrain_vall_holl" = "Valleys & hollows",
    "MI60_mmhr.lag_pwd"           = "PWD",
    "MI60_mmhr.mean_dnbr"         = "dNBR",
    "MI60_mmhr.terrain_elongation" = "Elongation",
    "MI60_mmhr.terrain_recharge" = 'Recharge areas',
    "MI60_mmhr.terrain_glacial" = "Glacial deposits",
    "MI60_mmhr.mulch_frac" = "Mulched areas",
    "MI60_mmhr.SP_mean" = 'Snow persistence',
    "MI60_mmhr.terrain_hypso75" = ">75% elevation",
    "MI60_mmhr.terrain_flowlength" = 'Flow length',
    "MI60_mmhr.soil_ksat" = 'Ksat')) %>%
    arrange(abs(mean)) %>%
    mutate(variable = factor(variable, levels = variable))

cpf_l2pInt_plot <- ggplot(cpf_l2p_inter, aes(y = variable)) +
  geom_vline(xintercept = 0) +
  # min to max (lightest)
  geom_linerange(aes(xmin = min, xmax = max), linewidth = 0.6, color = "steelblue1") +
  # 95% interval (medium)
  geom_linerange(aes(xmin = lower_95, xmax = upper_95), linewidth = 1, color = "steelblue3") +
  # 66% interval (darkest)
  geom_linerange(aes(xmin = lower_66, xmax = upper_66), linewidth = 2, color = "steelblue4") +
  # mean point
  geom_point(aes(x = mean), size = 4, shape = 21, fill = "white", color = "black") +
  labs(x = "Scaled coefficient", y = NULL) +
  theme(
    panel.grid = element_blank(),
    axis.text = element_text(color = "black"),
    axis.title = element_text(color = "black")) +
  ggtitle('CPF - Lag to peak')

plot_grid(cpf_l2pInt_plot,
          etf_l2pInt_plot)

```

## Interactiosn by SZ

```{r}


high_l2p_inter <- read_csv('./data/bayes_interaction_outputs/high_lag2peakInterac_summary_prelim.csv') %>%
  arrange(-abs(mean)) %>% 
    mutate(variable = dplyr::recode(variable,
    "MI60_mmhr.terrain_connec"    = "Connectivity",
    "MI60_mmhr.soil_clay"         = "Clay",
    "MI60_mmhr.terrain_slope30"   = "Slope > 30",
    "MI60_mmhr.terrain_vall_holl" = "Valleys & hollows",
    "MI60_mmhr.lag_pwd"           = "PWD",
    "MI60_mmhr.mean_dnbr"         = "dNBR",
    "MI60_mmhr.terrain_elongation" = "Elongation",
    "MI60_mmhr.terrain_recharge" = 'Recharge areas',
    "MI60_mmhr.terrain_glacial" = "Glacial deposits",
    "MI60_mmhr.mulch_frac" = "Mulched areas",
    "MI60_mmhr.SP_mean" = 'Snow persistence',
    "MI60_mmhr.terrain_hypso75" = ">75% elevation",
    "MI60_mmhr.terrain_flowlength" = 'Flow length',
    "MI60_mmhr.soil_ksat" = 'Ksat')) %>%
    arrange(abs(mean)) %>%
    mutate(variable = factor(variable, levels = variable))

high_l2pInt_plot <- ggplot(high_l2p_inter, aes(y = variable)) +
  geom_vline(xintercept = 0) +
  # min to max (lightest)
  geom_linerange(aes(xmin = min, xmax = max), linewidth = 0.6, color = "steelblue1") +
  # 95% interval (medium)
  geom_linerange(aes(xmin = lower_95, xmax = upper_95), linewidth = 1, color = "steelblue3") +
  # 66% interval (darkest)
  geom_linerange(aes(xmin = lower_66, xmax = upper_66), linewidth = 2, color = "steelblue4") +
  # mean point
  geom_point(aes(x = mean), size = 4, shape = 21, fill = "white", color = "black") +
  labs(x = "Scaled coefficient", y = NULL) +
  theme(
    panel.grid = element_blank(),
    axis.text = element_text(color = "black"),
    axis.title = element_text(color = "black")) +
  ggtitle('High SZ - Lag to peak')

low_l2p_inter <- read_csv('./data/bayes_interaction_outputs/low_lag2peakInterac_summary_prelim.csv') %>%
  arrange(-abs(mean)) %>% 
    mutate(variable = dplyr::recode(variable,
    "MI60_mmhr.terrain_connec"    = "Connectivity",
    "MI60_mmhr.soil_clay"         = "Clay",
    "MI60_mmhr.terrain_slope30"   = "Slope > 30",
    "MI60_mmhr.terrain_vall_holl" = "Valleys & hollows",
    "MI60_mmhr.lag_pwd"           = "PWD",
    "MI60_mmhr.mean_dnbr"         = "dNBR",
    "MI60_mmhr.terrain_elongation" = "Elongation",
    "MI60_mmhr.terrain_recharge" = 'Recharge areas',
    "MI60_mmhr.terrain_glacial" = "Glacial deposits",
    "MI60_mmhr.mulch_frac" = "Mulched areas",
    "MI60_mmhr.SP_mean" = 'Snow persistence',
    "MI60_mmhr.terrain_hypso75" = ">75% elevation",
    "MI60_mmhr.terrain_flowlength" = 'Flow length',
    "MI60_mmhr.soil_ksat" = 'Ksat')) %>%
    arrange(abs(mean)) %>%
    mutate(variable = factor(variable, levels = variable))

low_l2pInt_plot <- ggplot(low_l2p_inter, aes(y = variable)) +
  geom_vline(xintercept = 0) +
  # min to max (lightest)
  geom_linerange(aes(xmin = min, xmax = max), linewidth = 0.6, color = "steelblue1") +
  # 95% interval (medium)
  geom_linerange(aes(xmin = lower_95, xmax = upper_95), linewidth = 1, color = "steelblue3") +
  # 66% interval (darkest)
  geom_linerange(aes(xmin = lower_66, xmax = upper_66), linewidth = 2, color = "steelblue4") +
  # mean point
  geom_point(aes(x = mean), size = 4, shape = 21, fill = "white", color = "black") +
  labs(x = "Scaled coefficient", y = NULL) +
  theme(
    panel.grid = element_blank(),
    axis.text = element_text(color = "black"),
    axis.title = element_text(color = "black")) +
  ggtitle('Low SZ - Lag to peak')

plot_grid(low_l2pInt_plot,
          high_l2pInt_plot)


```

